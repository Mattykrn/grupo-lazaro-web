<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unirme – Grupo Lázaro</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>

  <body>
    <!-- Header común -->
    <header class="header-fixed">
      <div class="container flex">
        <img src="img/logo.png" alt="Logo Grupo Lázaro" class="logo" />
        <nav>
          <ul class="menu flex">
            <li><a href="index.html">Home</a></li>
            <li><a href="noticias.html">Noticias</a></li>
            <li><a href="unirme.html">Unirme</a></li>
            <li><a href="historias.html">Historias</a></li>
            <li><a href="nosotros.html">Nosotros</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <main class="container">
      <h1>Compartí tu historia</h1>
      <p class="text-center mb-8">Todo es anónimo y seguro. Tu experiencia puede dar esperanza a alguien que recién empieza el camino ❤️</p>

      <form id="form-unirme">
        <div class="form-group">
          <label for="nombre">¿Cómo querés que te llamemos? (opcional)</label>
          <input type="text" id="nombre" name="nombre" placeholder="Matías, Ana..." />
        </div>

        <div class="form-group">
          <label for="email">Email (opcional, para contacto futuro)</label>
          <input type="email" id="email" name="email" placeholder="tu@email.com" />
        </div>

        <div class="form-group">
          <label for="añoDiagnostico">Año de diagnóstico</label>
          <input type="text" id="añoDiagnostico" name="añoDiagnostico" placeholder="2020" required />
        </div>

        <div class="form-group">
          <label for="tipoEM">Tipo de Esclerosis Múltiple</label>
          <select id="tipoEM" name="tipoEM" required>
            <option value="">Seleccioná...</option>
            <option>Remitente-recurrente (RR)</option>
            <option>Secundaria progresiva (SP)</option>
            <option>Primaria progresiva (PP)</option>
            <option>Aún no lo sé</option>
          </select>
        </div>

        <div class="form-group">
          <label for="historia">Tu historia anónima (todo lo que quieras contar)</label>
          <textarea id="historia" name="historia" rows="8" placeholder="Contanos cómo vivís con la EM, qué te da esperanza..."></textarea>
        </div>

        <div class="form-group checkbox">
          <label>
            <input type="checkbox" name="aprobar" />
            Sí, quiero que mi historia aparezca anónimamente en el muro de esperanza
          </label>
        </div>

        <button type="submit" class="btn">Enviar con amor ❤️</button>
      </form>
    </main>

    <footer class="footer">
      <div class="container">
        <p>Grupo Lázaro © 2025 – No estás solo ❤️</p>
        <p>Contactanos: matii.toorres.06@gmail.com</p>
      </div>
    </footer>

    <!-- Script para enviar al backend SQLite -->
    <script>
      const form = document.getElementById('form-unirme');

      form.addEventListener('submit', async function handleSubmit(event) {
        event.preventDefault(); // Evita recarga de página

        // Recoge todos los datos del form
        const data = {
          nombre: form.nombre.value.trim() || 'Anónimo',
          email: form.email.value.trim() || '',
          añoDiagnostico: form.añoDiagnostico.value,
          tipoEM: form.tipoEM.value,
          historia: form.historia.value.trim() || 'Una persona más se unió a Lázaro ❤️'
        };

        try {
          // ENVÍA AL BACKEND (cambia la URL cuando tengas tu Render)
          const res = await fetch('https://lazaro-backend-sqlite.onrender.com/api/stories', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });

          if (res.ok) {
            alert("¡Tu historia se envió con amor! ❤️ Gracias por confiar en nosotros. La revisaremos pronto.");
            form.reset(); // Limpia el formulario
          } else {
            alert("Hubo un error al enviar. Intentá de nuevo más tarde.");
          }
        } catch (err) {
          alert("Error de conexión. Tu historia es importante, intentá más tarde ❤️");
        }
      });
    </script>
  </body>
</html>